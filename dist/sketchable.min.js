!function(u){var p="sketchable",c=u.document;function i(e,t){if(e)return"string"==typeof e&&(e=c.querySelector(e)),this.elem=e,this.init(t);throw new Error("Sketchable requires a DOM element.")}function s(e,t){(t=t||dataBind(e)[p].options).cssCursors&&(e.style.cursor=t.interactive?"pointer":"not-allowed"),e.onselectstart=function(){return!1}}function l(e){var t,n,o,i=e.target,s=(r=(r=i).getBoundingClientRect(),t=c.body,n=c.documentElement,o=u.pageYOffset||n.scrollTop||t.scrollTop,a=u.pageXOffset||n.scrollLeft||t.scrollLeft,s=n.clientTop||t.clientTop||0,n=n.clientLeft||t.clientLeft||0,t=r.top+o-s,o=r.left+a-n,{top:Math.round(t),left:Math.round(o)}),r=i.width/i.offsetWidth,a=i.height/i.offsetHeight;return{x:Math.round((e.pageX-s.left)*r),y:Math.round((e.pageY-s.top)*a),time:Date.now()}}function f(e,t,n){var o=t.coords[e];t.options.relTimestamps&&(0===t.strokes.length&&0===o.length&&(t.timestamp=n.time),n.time-=t.timestamp),o.push([n.x,n.y,n.time,+t.sketch.isDrawing,e]),t.options.filterCoords&&1<o.length&&(e=o[n=o.length-1],t=o[n-1],e[0]==t[0])&&e[1]==t[1]&&o.splice(n,1)}function r(e){if(e.touches)return!1;t(e)}function a(e){if(e.touches)return!1;n(e)}function h(e){if(e.touches)return!1;o(e)}function d(e){g(e,t),e.preventDefault()}function v(e){g(e,n),e.preventDefault()}function m(e){g(e,o),e.preventDefault()}function t(e){if(Event.isRightClick(e))return!1;var t,n,o=Math.abs(e.identifier||0),i=e.target,s=dataBind(i)[p],r=s.options;r.interactive&&(t=l(e),"function"==typeof r.events.mousedownBefore&&r.events.mousedownBefore(i,s,e),0<r.graphics.firstPointSize&&s.sketch.beginFill(r.graphics.fillStyle).fillCircle(t.x,t.y,r.graphics.firstPointSize).endFill(),s.sketch.isDrawing=!0,s.sketch.beginPath(),0<(n=(n=s.coords[o])||[]).length&&s.strokes.push(n),s.coords[o]=[],f(o,s,t),"function"==typeof r.events.mousedown)&&r.events.mousedown(i,s,e)}function n(e){var t,n,o,i,s=Math.abs(e.identifier||0),r=e.target,a=dataBind(r)[p],u=a.options;u.interactive&&(u.mouseupMovements&&0!==a.strokes.length||a.sketch.isDrawing)&&(t=l(e),"function"==typeof u.events.mousemoveBefore&&u.events.mousemoveBefore(r,a,e),(n=(n=a.coords[s])[n.length-1])&&(a.sketch.isDrawing?(o=u.graphics.strokeStyle,i=u.graphics.lineWidth):u.mouseupMovements&&(o=u.mouseupMovements.strokeStyle||"#DDD",i=u.mouseupMovements.lineWidth||1),a.sketch.lineStyle(o,i).line(n[0],n[1],t.x,t.y).stroke()),f(s,a,t),"function"==typeof u.events.mousemove)&&u.events.mousemove(r,a,e)}function o(e){var t=Math.abs(e.identifier||0),n=e.target,o=dataBind(n)[p],i=o.options;i.interactive&&("function"==typeof i.events.mouseupBefore&&i.events.mouseupBefore(n,o,e),o.sketch.isDrawing=!1,o.sketch.closePath(),o.strokes.push(o.coords[t]),o.coords[t]=[],"function"==typeof i.events.mouseup)&&i.events.mouseup(n,o,e)}function g(e,t){var n=e.target,n=dataBind(n)[p].options;if(n.multitouch)for(var o,i=e.changedTouches,s=0;s<i.length;s++)y(o=i[s],e),t(o);else y(o=e.touches[0],e),t(o);e.preventDefault()}function y(e,t){e.type||(e.type=t.type)}(i.prototype={init:function(e){var t,e=deepExtend({},i.prototype.defaults,e||{}),n=this.elem,o=(dataBind(n)[p]||(Event.add(n,"mousedown",r),Event.add(n,"mousemove",a),Event.add(n,"mouseup",h),Event.add(n,"touchstart",d),Event.add(n,"touchmove",v),Event.add(n,"touchend",m),s(n,e)),new jSketch(n,e.graphics));for(t in dataBind(n)[p]=o={strokes:[],coords:{},timestamp:0,sketch:o,instance:this,options:e},"function"==typeof e.events.init&&e.events.init(n,o),this.plugins)this.plugins[t](this);return this},config:function(e){var t=this.elem,n=dataBind(t)[p];return e?(n.options=deepExtend({},i.prototype.defaults,n.options,e),s(t),this):n.options},data:function(e){var t=this.elem,t=dataBind(t)[p];return e?t[e]:t},strokes:function(e){var t=this.elem,n=dataBind(t)[p];if(e){n.strokes=e;var o=dataBind(t)[p],i=o.options,s=o.sketch;s.clear();for(var r,a,u=0;u<o.strokes.length;u++)for(var c=o.strokes[u],l=0;l<c.length;l++){var f=c[l],h=c[l+1],d=!0;if(!(d=3<f.length?1===f[3]:d)&&!i.mouseupMovements)break;0===l?(0<i.graphics.firstPointSize&&s.beginFill(i.graphics.fillStyle).fillCircle(f[0],f[1],i.graphics.firstPointSize).endFill(),d?(r=i.graphics.strokeStyle,a=i.graphics.lineWidth):i.mouseupMovements&&(r=i.mouseupMovements.strokeStyle||"#DDD",a=i.mouseupMovements.lineWidth||1),s.lineStyle(r,a)):h&&s.beginPath().line(f[0],f[1],h[0],h[1]).stroke().closePath()}return this}return n.strokes},handler:function(e){var t=this.elem;return e(t,dataBind(t)[p]),this},trigger:function(e){var t=this.elem,n=dataBind(t)[p],o=n.options.events;return o&&"function"==typeof o[e]&&o[e](t,n),this},clear:function(e){var t=this.elem,n=dataBind(t)[p],o=n.options;return n.sketch.clear(),e||(n.strokes=[],n.coords={}),"function"==typeof o.events.clear&&o.events.clear(t,n),this},reset:function(e){var t=this.elem,n=dataBind(t)[p],o=n.options;return this.destroy().init(e),"function"==typeof o.events.reset&&o.events.reset(t,n),this},destroy:function(){var e=this.elem,t=dataBind(e)[p],n=t.options;return Event.remove(e,"mouseup",h),Event.remove(e,"mousemove",a),Event.remove(e,"mousedown",r),Event.remove(e,"touchstart",d),Event.remove(e,"touchmove",v),Event.remove(e,"touchend",m),"function"==typeof n.events.destroy&&n.events.destroy(e,t),dataBind(e)[p]=null,this},decorate:function(e,t,n){var o,i=this.elem,i=dataBind(i)[p],s=i.options,n="_bound$"+e+"."+n;if(!i[n])return i[n]=!0,s.events&&"function"==typeof s.events[e]?(o=s.events[e],s.events[e]=function(){o.apply(this,arguments),t.apply(this,arguments)}):s.events[e]=t,this}}).plugins={},i.prototype.defaults={interactive:!0,mouseupMovements:!1,relTimestamps:!1,multitouch:!0,cssCursors:!0,filterCoords:!1,events:{},graphics:{firstPointSize:3,lineWidth:3,strokeStyle:"#F0F",fillStyle:"#F0F",lineCap:"round",lineJoin:"round",miterLimit:10}},u.Sketchable=i}(this);