!function(p){var v="sketchable",n={init:function(t){var i=p.extend(!0,{},p.fn.sketchable.defaults,t||{});return this.each(function(){var t,e=p(this),n=(e.data(v)||(e.bind("mousedown",s),e.bind("mousemove",r),e.bind("mouseup",a),e.bind("touchstart",u),e.bind("touchmove",f),e.bind("touchend",l),o(e,i)),new jSketch(this,i.graphics));for(t in e.data(v,{strokes:[],coords:{},timestamp:0,sketch:n,options:i}),"function"==typeof i.events.init&&i.events.init(e,e.data(v)),p.fn.sketchable.plugins)p.fn.sketchable.plugins[t](e)})},config:function(n){return n?this.each(function(){var t=p(this),e=t.data(v);e.options=p.extend(!0,{},p.fn.sketchable.defaults,e.options,n),o(t)}):p(this).data(v).options},data:function(t){var e=p(this).data(v);return t?e[t]:e},strokes:function(l){return l?this.each(function(){var t=p(this);t.data(v).strokes=l;var e=t.data(v),n=e.options,i=e.sketch;i.clear();for(var o,s,r=0;r<e.strokes.length;r++)for(var a=e.strokes[r],u=0;u<a.length;u++){var c=a[u],h=a[u+1],f=!0;if(!(f=3<c.length?1===c[3]:f)&&!n.mouseupMovements)break;0===u?(0<n.graphics.firstPointSize&&i.beginFill(n.graphics.fillStyle).fillCircle(c[0],c[1],n.graphics.firstPointSize).endFill(),f?(o=n.graphics.strokeStyle,s=n.graphics.lineWidth):n.mouseupMovements&&(o=n.mouseupMovements.strokeStyle||"#DDD",s=n.mouseupMovements.lineWidth||1),i.lineStyle(o,s)):h&&i.beginPath().line(c[0],c[1],h[0],h[1]).stroke().closePath()}}):p(this).data(v).strokes},handler:function(n){return this.each(function(){var t=p(this),e=t.data(v);n(t,e)})},trigger:function(i){return this.each(function(){var t=p(this),e=t.data(v),n=e.options.events;n&&"function"==typeof n[i]&&n[i](t,e)})},clear:function(i){return this.each(function(){var t=p(this),e=t.data(v),n=e.options;e.sketch.clear(),i||(e.strokes=[],e.coords={}),"function"==typeof n.events.clear&&n.events.clear(t,e)})},reset:function(i){return this.each(function(){var t=p(this),e=t.data(v),n=e.options;t.sketchable("destroy").sketchable(i),"function"==typeof n.events.reset&&n.events.reset(t,e)})},destroy:function(){return this.each(function(){var t=p(this),e=t.data(v),n=e.options;t.unbind("mouseup",a),t.unbind("mousemove",r),t.unbind("mousedown",s),t.unbind("touchstart",u),t.unbind("touchmove",f),t.unbind("touchend",l),t.removeData(v),n&&"function"==typeof n.events.destroy&&n.events.destroy(t,e)})},decorate:function(o,s,r){return this.each(function(){var t,e=p(this).data(v),n=e.options,i="_bound$"+o+"."+r;e[i]||(e[i]=!0,n.events&&"function"==typeof n.events[o]?(t=n.events[o],n.events[o]=function(){t.apply(this,arguments),s.apply(this,arguments)}):n.events[o]=s)})}};function o(t,e){e=e||t.data(v).options;t=t.get(0);e.cssCursors&&(t.style.cursor=e.interactive?"pointer":"not-allowed"),t.onselectstart=function(){return!1}}function c(t){var e=p(t.target).offset();return{x:Math.round(t.pageX-e.left),y:Math.round(t.pageY-e.top),time:Date.now()}}function h(t,e,n){var i=e.coords[t];e.options.relTimestamps&&(0===e.strokes.length&&0===i.length&&(e.timestamp=n.time),n.time-=e.timestamp),i.push([n.x,n.y,n.time,+e.sketch.isDrawing,t]),e.options.filterCoords&&1<i.length&&(t=i[n=i.length-1],e=i[n-1],t[0]==e[0])&&t[1]==e[1]&&i.splice(n,1)}function s(t){if(t.originalEvent.touches)return!1;e(t)}function r(t){if(t.originalEvent.touches)return!1;i(t)}function a(t){if(t.originalEvent.touches)return!1;d(t)}function u(t){m(t,e),t.preventDefault()}function f(t){m(t,i),t.preventDefault()}function l(t){m(t,d),t.preventDefault()}function e(t){if(3===t.which)return!1;var e,n,i=Math.abs(t.identifier||0),o=p(t.target),s=o.data(v),r=s.options;r.interactive&&(e=c(t),"function"==typeof r.events.mousedownBefore&&r.events.mousedownBefore(o,s,t),0<r.graphics.firstPointSize&&s.sketch.beginFill(r.graphics.fillStyle).fillCircle(e.x,e.y,r.graphics.firstPointSize).endFill(),s.sketch.isDrawing=!0,s.sketch.beginPath(),0<(n=(n=s.coords[i])||[]).length&&s.strokes.push(n),s.coords[i]=[],h(i,s,e),"function"==typeof r.events.mousedown)&&r.events.mousedown(o,s,t)}function i(t){var e,n,i,o,s=Math.abs(t.identifier||0),r=p(t.target),a=r.data(v),u=a.options;u.interactive&&(u.mouseupMovements&&0!==a.strokes.length||a.sketch.isDrawing)&&(e=c(t),"function"==typeof u.events.mousemoveBefore&&u.events.mousemoveBefore(r,a,t),(n=(n=a.coords[s])[n.length-1])&&(a.sketch.isDrawing?(i=u.graphics.strokeStyle,o=u.graphics.lineWidth):u.mouseupMovements&&(i=u.mouseupMovements.strokeStyle||"#DDD",o=u.mouseupMovements.lineWidth||1),a.sketch.lineStyle(i,o).line(n[0],n[1],e.x,e.y).stroke()),h(s,a,e),"function"==typeof u.events.mousemove)&&u.events.mousemove(r,a,t)}function d(t){var e=Math.abs(t.identifier||0),n=p(t.target),i=n.data(v),o=i.options;o.interactive&&("function"==typeof o.events.mouseupBefore&&o.events.mouseupBefore(n,i,t),i.sketch.isDrawing=!1,i.sketch.closePath(),i.strokes.push(i.coords[e]),i.coords[e]=[],"function"==typeof o.events.mouseup)&&o.events.mouseup(n,i,t)}function m(t,e){var n=p(t.target).data(v).options;if(n.multitouch)for(var i,o=t.originalEvent.changedTouches,s=0;s<o.length;s++)g(i=o[s],t.originalEvent),e(i);else g(i=t.originalEvent.touches[0],t.originalEvent),e(i)}function g(t,e){t.type||(t.type=e.type)}p.fn.sketchable=function(t){var e=Array.prototype.slice.call(arguments,1);return"object"!=typeof t&&t?-1<t.indexOf(".")?function(t,e){e=e.split(".");for(var n=0;n<e.length;n++){var i=e[n];t=t[i]}return t}(n,t).apply(this,e):n[t]?n[t].apply(this,e):(p.error("Unknown method: "+t),this):n.init.apply(this,arguments)},p.fn.sketchable.api=n,p.fn.sketchable.plugins={},p.fn.sketchable.defaults={interactive:!0,mouseupMovements:!1,relTimestamps:!1,multitouch:!0,cssCursors:!0,filterCoords:!1,events:{},graphics:{firstPointSize:3,lineWidth:3,strokeStyle:"#F0F",fillStyle:"#F0F",lineCap:"round",lineJoin:"round",miterLimit:10}}}(jQuery);