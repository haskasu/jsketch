!function(i){var c="sketchable";function a(r){var s=[],o=-1,t=this;function n(n){r.sketchable("handler",function(e,t){n&&0<n.identifier?s[o].strokes=t.strokes.slice():(s.push({image:e.get(0).toDataURL(),strokes:t.strokes.slice(),callStack:t.sketch.callStack.slice()}),o++)})}function e(e){if(e.ctrlKey)switch(e.which){case 26:e.shiftKey?t.redo():t.undo();break;case 25:t.redo()}}this.undo=function(){return 0<o&&(o--,this.restore(),r.sketchable("trigger","mementoundo")),this},this.redo=function(){return o<s.length-1&&(o++,this.restore(),r.sketchable("trigger","mementoredo")),this},this.reset=function(){return s=[],o=-1,r.sketchable("trigger","mementoreset"),n(),this},this.save=function(e){return n(e),r.sketchable("trigger","mementosave"),this},this.state=function(){return JSON.parse(JSON.stringify(s[o]))},this.restore=function(e){e=e||s[o];var t=new Image;return t.src=e.image,t.onload=function(){var n,s;n=this,s=e,r.sketchable("handler",function(e,t){t.sketch.clear(),t.sketch.context.drawImage(n,0,0),t.strokes=s.strokes.slice(),t.sketch.callStack=s.callStack.slice()}),r.sketchable("trigger","mementochange")},this},this.init=function(){return i(document).off("keypress",e),i(document).on("keypress",e),r.sketchable("trigger","mementoinit"),n(),this},this.destroy=function(){return i(document).off("keypress",e),r.sketchable("trigger","mementodestroy"),this.reset()}}i.fn.sketchable.plugins.memento=function(t){for(var e={clear:function(e,t){t.memento.reset()},mouseup:function(e,t,n){t.memento.save(n)},destroy:function(e,t){t.memento.destroy()}},n="mouseup clear destroy".split(" "),s=0;s<n.length;s++){var r=n[s];t.sketchable("decorate",r,e[r],"memento")}i.extend(i.fn.sketchable.api,{memento:{undo:function(){return i(this).data(c).memento.undo(),t},redo:function(){return i(this).data(c).memento.redo(),t},save:function(){return i(this).data(c).memento.save(),t},state:function(){return i(this).data(c).memento.state()},restore:function(e){return i(this).data(c).memento.restore(e),t}}});var o=t.sketchable("data");o.memento=new a(t),o.memento.init()}}(jQuery);